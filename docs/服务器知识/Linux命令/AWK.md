http://www.zsythink.net/archives/1357/

https://blog.csdn.net/lxw1844912514/article/details/108464923

awk 是一种编程语言， 用于在linux/unix下对文本和数据进行处理。 数据可以来自标准输入
(stdin)、 一个或多个文件， 或其它命令的输出。 它支持用户自定义函数和动态正则表达式等先进功
能， 是linux/unix下的一个强大编程工具。 它在命令行中使用， 但更多是作为脚本来使用。 awk有很
多内建的功能， 比如数组、 函数等， 这是它和C语言的相同之处， 灵活性是awk最大的优势。  

## awk命令格式和选项  

语法形式:

```shell
awk [options] 'script' var=value file(s)
awk [options] -f scriptfile var=value file(s)  
```

常用命令选项

- -F fs fs指定输入分隔符， fs可以是字符串或正则表达式， 如-F:
- -v var=value 赋值一个用户定义变量， 将外部变量传递给awk
- -f scripfile 从脚本文件中读取awk命令
- -m[fr] val 对val值设置内在限制， -mf选项限制分配给val的最大块数目； -mr选项限制记录
    的最大数目。 这两个功能是Bell实验室版awk的扩展功能， 在标准awk中不适用。  

## awk的工作原理

```sh
awk 'BEGIN{ commands } pattern{ commands } END{ commands }'
```

- 第一步： 执行 BEGIN{ commands } 语句块中的语句；

- 第二步： 从文件或标准输入(stdin)读取一行， 然后执行 pattern{ commands } 语句块， 它逐
    行扫描文件， 从第一行到最后一行重复这个过程， 直到文件全部被读取完毕。

- 第三步： 当读至输入流末尾时， 执行 END{ commands } 语句块。

注意：
1. BEGIN语句块 在awk开始从输入流中读取行 之前 被执行， 这是一个可选的语句块， 比如变量初始化、 打印输出表格的表头等语句通常可以写在BEGIN语句块中。

2. END语句块 在awk从输入流中读取完所有的行 之后 即被执行， 比如打印所有行的分析结果这类信息汇总都是在END语句块中完成， 它也是一个可选语句块。

3. pattern语句块 中的通用命令是最重要的部分， 它也是可选的。 如果没有提供pattern语句块， 则默认执行 { print } ， 即打印每一个读取到的行， awk读取的每一行都会执行该语句块。  

## awk内置变量（ 预定义变量）

```sh
**$n** 当前记录的第n个字段， 比如n为1表示第一个字段， n为2表示第二个字段。
**$0** 这个变量包含执行过程中当前行的文本内容。
[N] **ARGC** 命令行参数的数目。
[G] **ARGIND** 命令行中当前文件的位置（从0开始算） 。
[N] **ARGV** 包含命令行参数的数组。
[G] **CONVFMT** 数字转换格式（默认值为%.6g） 。
[P] **ENVIRON** 环境变量关联数组。
[N] **ERRNO** 最后一个系统错误的描述。
[G] **FIELDWIDTHS** 字段宽度列表（用空格键分隔） 。
[A] **FILENAME** 当前输入文件的名。
[P] **FNR** 同NR， 但相对于当前文件。
[A] **FS** 字段分隔符（默认是任何空格） 。
[G] **IGNORECASE** 如果为真， 则进行忽略大小写的匹配。
[A] **NF** 表示字段数， 在执行过程中对应于当前的字段数。
[A] **NR** 表示记录数， 在执行过程中对应于当前的行号。
[A] **OFMT** 数字的输出格式（默认值是%.6g） 。
[A] **OFS** 输出字段分隔符（默认值是一个空格） 。
[A] **ORS** 输出记录分隔符（默认值是一个换行符） 。
[A] **RS** 记录分隔符（默认是一个换行符） 。
[N] **RSTART** 由match函数所匹配的字符串的第一个位置。
[N] **RLENGTH** 由match函数所匹配的字符串的长度。
[N] **SUBSEP** 数组下标分隔符（默认值是34）。
```

